(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6899fd02"],{"6dbd":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"pqexplorer"}},[a("v-navigation-drawer",{staticClass:"no-print",attrs:{app:"",clipped:"",permanent:"","mini-variant":t.mini,"mini-variant-width":"80",stateless:"",dark:"",width:"320"}},[a("v-list-item",[a("v-list-item-content",[a("v-icon",{on:{click:function(e){t.mini=!t.mini}}},[t._v("mdi-unfold-more-vertical")])],1)],1),a("v-divider"),a("v-list",[a("v-list-item",{on:{click:function(e){return t.print2pdf()}}},[a("v-list-item-icon",[a("v-icon",[t._v("mdi-printer")])],1),a("v-list-item-title",[t._v("Print to PDF")])],1)],1)],1),a("v-container",[a("v-row",[a("v-col",{attrs:{cols:"12"}},[a("h2",{staticStyle:{"text-align":"center"}},[t._v("UCLA Radiation Oncology")]),a("h2",{staticStyle:{"text-align":"center"}},[t._v("Plan Quality Database Explorer")])])],1),a("v-row",[a("v-col",[a("v-card",[a("v-card-title",[t._v("Population Statistics")]),a("v-card-text",[a("v-container",[a("v-row",[a("v-col",{attrs:{cols:"6"}},[a("v-combobox",{attrs:{label:"Constraint Folder",hint:"Select a treatment area",items:t.cc_folders},on:{change:function(e){t.retrieve_templates(),t.sel_template=""}},model:{value:t.sel_folder,callback:function(e){t.sel_folder=e},expression:"sel_folder"}})],1),a("v-col",{attrs:{cols:"6"}},[a("v-combobox",{attrs:{label:"Constraint Template",hint:"Select a template to view constraints",items:t.cc_templates,"item-text":"template","return-object":""},on:{change:function(e){t.laterality=t.sel_template.laterality,t.retrieve_dose_levels(),t.retrieve_patients(),t.retrieve_stats()}},model:{value:t.sel_template,callback:function(e){t.sel_template=e},expression:"sel_template"}})],1),a("v-col",{attrs:{cols:"3"}},[a("v-combobox",{attrs:{label:"Laterality",items:t.lat_opts},on:{change:function(e){t.retrieve_patients(),t.retrieve_stats()}},model:{value:t.laterality,callback:function(e){t.laterality=e},expression:"laterality"}})],1),a("v-col",{attrs:{cols:"3"}},[a("v-combobox",{attrs:{label:"Dose Per Fraction (cGy)",items:t.dose_opts},on:{change:function(e){t.retrieve_patients(),t.retrieve_stats()}},model:{value:t.fractional_dose,callback:function(e){t.fractional_dose=e},expression:"fractional_dose"}})],1),a("v-col",{attrs:{cols:"12"}},[t.sel_template?a("h2",[t._v("Constraints")]):t._e()]),a("v-col",{attrs:{cols:"12"}},[t.sel_template?a("v-simple-table",{attrs:{dense:""},scopedSlots:t._u([{key:"default",fn:function(){return[a("tbody",[a("tr",[a("th",[t._v("Structure")]),a("th",[t._v("Constraint")]),a("th",[t._v("Goal")]),t.stats?a("th",[t._v("UCLA Population"),a("br"),t._v("(Mean "+t._s(t.plusminus)+" St. Dev.)")]):t._e(),t.stats?a("th",[t._v("UCLA Population Distribution")]):t._e()]),t._l(t.sel_template.constraints,(function(e){return a("tr",{key:e.Priority},[a("td",[t._v(t._s(e.StructureTemplate))]),a("td",[t._v(t._s(e.ConstraintToPresent))]),a("td",[t._v(t._s(e.GoalLimitToPresent))]),t.stats?a("td",[t._v(t._s(t.stats[e.Priority].mean.toFixed(2))+" "+t._s(t.plusminus)+" "+t._s(t.stats[e.Priority].std.toFixed(2)))]):t._e(),t.stats?a("td",[a("pqrBoxplot",{key:t.stats[e.Priority].mean,attrs:{p_item:e,p_stats:t.stats[e.Priority],p_flip:t.reporter}})],1):t._e()])}))],2)]},proxy:!0}],null,!1,3659894850)}):t._e()],1),a("v-col",{attrs:{cols:"12"}},[t.pt_counter>0?a("h2",[t._v("Patients ("+t._s(t.pt_counter)+")")]):t._e()]),a("v-col",{attrs:{cols:"12"}},[t.pt_counter>0?a("v-simple-table",{attrs:{dense:""},scopedSlots:t._u([{key:"default",fn:function(){return[a("tbody",[a("tr",[a("th",[t._v("MRN")]),a("th",[t._v("Course")]),a("th",[t._v("Plan")]),a("th",[t._v("Laterality")])]),t._l(t.cc_patients,(function(e){return a("tr",{key:e.mrn},[a("td",[t._v(t._s(e.mrn))]),a("td",[t._v(t._s(e.course_id))]),a("td",[t._v(t._s(e.plan_id))]),a("td",[t._v(t._s(e.laterality))])])}))],2)]},proxy:!0}],null,!1,1447051112)}):t._e()],1)],1)],1)],1),a("v-card-actions",[a("v-btn",{attrs:{color:"#2774AE",text:""},on:{click:function(e){return e.stopPropagation(),t.refresh_templates()}}},[t._v(" Refresh List ")]),a("v-btn",{attrs:{color:"#2774AE",text:""},on:{click:function(e){return e.stopPropagation(),t.clear_templates()}}},[t._v(" Clear ")])],1)],1)],1)],1)],1)],1)},r=[],s=a("ade3"),n=(a("d3b7"),a("7bfd")),o={name:"PQExplorer",data:function(){return{mini:!0,cc_folders:[],sel_folder:null,cc_templates:[],sel_template:null,pt_counter:0,cc_patients:[],laterality:null,lat_opts:["Left","Right","Both","None"],fractional_dose:"All",dose_opts:["All"],stats:null,plusminus:"Â±",reporter:!1}},mounted:function(){this.retrieve_folders()},methods:{retrieve_folders:function(){var t=this;fetch("/api/pqr_templates/folders").then((function(t){return t.json()})).then((function(e){t.messages=e,t.cc_folders=e.folders}))},retrieve_templates:function(){var t=this,e="/api/pqr_templates/templates/";e+=this.sel_folder,fetch(e).then((function(t){return t.json()})).then((function(e){t.messages=e,t.cc_templates=e.templates}))},retrieve_dose_levels:function(){var t=this;this.dose_opts=["All"];var e="/api/pqr_patients/dose_levels/";e+=this.sel_folder,e+="/",e+=this.sel_template.template,e+="/",e+=this.laterality,fetch(e).then((function(t){return t.json()})).then((function(e){t.dose_opts=e.dose_levels,t.dose_opts.push("All")}))},retrieve_patients:function(){var t=this,e="/api/pqr_patients/template/";e+=this.sel_folder,e+="/",e+=this.sel_template.template,e+="/",e+=this.laterality,e+="/",e+=this.fractional_dose,fetch(e).then((function(t){return t.json()})).then((function(e){t.messages=e,t.cc_patients=e.patients,t.pt_counter=e.pt_count}))},retrieve_stats:function(){var t=this;this.stats=null;var e="/api/pqr_patients/stats/";e+=this.sel_folder,e+="/",e+=this.sel_template.template,e+="/",e+=this.laterality,e+="/",e+=this.fractional_dose,fetch(e).then((function(t){return t.json()})).then((function(e){var a=e.stats;a.length>0&&(t.stats={});for(var i=0;i<a.length;i++){for(var r,n=a[i].data.reduce((function(t,e){return t+e}))/a[i].data.length,o=0,l=0;l<a[i].data.length;l++)o+=Math.pow(a[i].data[l]-n,2);var c=Math.sqrt(o/a[i].data.length);t.stats[a[i]._id]=(r={},Object(s["a"])(r,"data",a[i].data),Object(s["a"])(r,"mean",n),Object(s["a"])(r,"std",c),r)}}))},refresh_templates:function(){this.retrieve_folders(),this.retrieve_templates()},clear_templates:function(){this.sel_template="",this.sel_folder="",this.stats=null,this.laterality=null,this.fractional_dose=null,this.pt_counter=0},print2pdf:function(){window.print()}},components:{pqrBoxplot:n["a"]}},l=o,c=a("2877"),u=a("6544"),p=a.n(u),d=a("8336"),h=a("b0af"),_=a("99d9"),v=a("62ad"),f=a("2b5d"),m=a("a523"),b=a("ce7e"),x=a("132d"),y=a("8860"),g=a("da13"),w=a("5d23"),k=a("34c3"),P=a("f774"),C=a("0fd9"),V=a("1f4f"),L=Object(c["a"])(l,i,r,!1,null,null,null);e["default"]=L.exports;p()(L,{VBtn:d["a"],VCard:h["a"],VCardActions:_["a"],VCardText:_["c"],VCardTitle:_["d"],VCol:v["a"],VCombobox:f["a"],VContainer:m["a"],VDivider:b["a"],VIcon:x["a"],VList:y["a"],VListItem:g["a"],VListItemContent:w["a"],VListItemIcon:k["a"],VListItemTitle:w["b"],VNavigationDrawer:P["a"],VRow:C["a"],VSimpleTable:V["a"]})},"7bfd":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.checker?a("v-card",{attrs:{outlined:""}},[a("div",{attrs:{align:"center",id:t.plot_id}})]):t._e()},r=[],s=(a("cb29"),a("ac1f"),a("1276"),a("caad"),a("2532"),a("61cc")),n=a.n(s),o={name:"pqrBoxplot",props:["p_item","p_stats","p_flip"],data:function(){return{item:this.p_item,stats:this.p_stats,flipper:this.p_flip}},computed:{plot_id:function(){var t="boxplot_"+this.item.Priority;return t},idx:function(){return this.item.PriorityMatch},checker:function(){return!!this.stats&&this.stats.data.length>0},marker_color:function(){var t={Pass:"green",Fail:"red",Condition:"orange",Verified:"blue","":"black"};return t[this.item.PassFail]},value:function(){var t=0;return this.flipper&&(t=this.item.ActualValue),t},x_data:function(){return this.idx<0?[0]:this.stats.data},y_data:function(){if(this.idx<0)return[0];var t=new Array(this.stats.data.length).fill(0);return t},ideal:function(){var t=this.item.GoalLimitToPresent,e=t.split(this.item.GoalLimitActualUnit,1),a=e[0].split("-",2);return parseFloat(a[0])},acceptable:function(){var t=this.item.GoalLimitToPresent,e=t.split(this.item.GoalLimitActualUnit,1);if(e[0].includes("-")){var a=e[0].split("-",2);return parseFloat(a[1])}return null},accept_x:function(){return[this.acceptable]},goal_x:function(){return[this.ideal]},goal_y:function(){return[0]},boxpoints:function(){return this.flipper?"suspectedoutliers":"all"},boxcolors:function(){return this.flipper?"rgba(219, 64, 82, 0.6)":"rgba(20,120,180)"},trace1:function(){var t={type:"box",name:"UCLA Patients",x:this.x_data,y:this.y_data,hoverdata:"x",orientation:"h",boxpoints:this.boxpoints,boxmean:"sd",jitter:.3,whiskerwidth:.5,marker:{size:3,color:this.boxcolors,outliercolor:"rgba(219, 64, 82, 0.6)",line:{outliercolor:"rgba(219, 64, 82, 1.0)",outlierwidth:1},opacity:.5},line:{color:"rgb(20,120,180)",opacity:.75,width:1}};return t},trace2:function(){var t={x:[this.value],y:[0],hoverdata:"x",type:"scatter",name:"Current Patient",mode:"markers",marker:{color:this.marker_color,size:10,opacity:.5}};return t},trace3:function(){var t={x:this.goal_x,y:this.goal_y,hoverdata:"x",type:"box",name:"Goal",orientation:"h",boxpoints:!1,whiskerwidth:1,opacity:.7,line:{color:"darkgreen",width:1}};return t},trace4:function(){var t={x:this.accept_x,y:this.goal_y,hoverdata:"x",type:"box",name:"Goal",orientation:"h",boxpoints:!1,whiskerwidth:1,opacity:.5,line:{color:"orange",width:1}};return t},layout:function(){var t={showlegend:!1,xaxis:{showgrid:!0,gridcolor:"rgb(220, 220, 220)",zeroline:!1,rangemode:"nonnegative",tickfont:{size:10},hoverformat:".1f"},yaxis:{showline:!1,visible:!1},width:225,height:60,margin:{l:16,r:16,b:24,t:2,pad:0},hoverlabel:{size:7}};return t}},mounted:function(){this.updatePlot(),this.$watch("stats",this.updatePlot)},methods:{updatePlot:function(){document.getElementById(this.plot_id)&&n.a.purge(this.plot_id);var t=null;t=this.flipper?[this.trace1,this.trace2,this.trace3,this.trace4]:[this.trace1,this.trace3,this.trace4],this.checker&&n.a.newPlot(this.plot_id,t,this.layout)}},watch:{chart:{handler:function(){n.a.react(this.$refs[this.chart.uuid],this.chart.traces,this.chart.layout)},deep:!0}}},l=o,c=a("2877"),u=a("6544"),p=a.n(u),d=a("b0af"),h=Object(c["a"])(l,i,r,!1,null,null,null);e["a"]=h.exports;p()(h,{VCard:d["a"]})}}]);
//# sourceMappingURL=chunk-6899fd02.f5e635e3.js.map